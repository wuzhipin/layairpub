window.wxMiniGame=function(e,t){"use strict";function ImageDataPolyfill(){let e,i,a;if(3==arguments.length){if(!(arguments[0]instanceof Uint8ClampedArray))throw new Error("Failed to construct 'ImageData': parameter 1 is not of type 'Uint8ClampedArray'.");if(arguments[0].length%4!=0)throw new Error("Failed to construct 'ImageData': The input data length is not a multiple of 4.");if(arguments[0].length!==arguments[1]*arguments[2]*4)throw new Error("Failed to construct 'ImageData': The input data length is not equal to (4 * width * height).");a=arguments[0],e=arguments[1],i=arguments[2]}else if(2==arguments.length)e=arguments[0],i=arguments[1],a=new Uint8ClampedArray(arguments[0]*arguments[1]*4);else if(arguments.length<2)throw new Error("Failed to construct 'ImageData': 2 arguments required, but only "+arguments.length+" present.");let n=t.Browser.canvas.getContext("2d").getImageData(0,0,e,i);for(let e=0;e<a.length;e+=4)n.data[e]=a[e],n.data[e+1]=a[e+1],n.data[e+2]=a[e+2],n.data[e+3]=a[e+3];return n}class i{static isLocalNativeFile(e){for(var t=0,i=d.nativefiles.length;t<i;t++)if(-1!=e.indexOf(d.nativefiles[t]))return!0;return!1}static isLocalNativeZipFile(e){for(var t=0,i=d.nativezipfiles.length;t<i;t++)if(-1!=e.indexOf(d.nativezipfiles[t]))return!0;return!1}static isNetFile(e){return(-1!=e.indexOf("http://")||-1!=e.indexOf("https://"))&&-1==e.indexOf(d.window.wx.env.USER_DATA_PATH)}static getFileInfo(e){var t=e,a=i.fakeObj[t];return null==a?null:a}static read(e,a="utf8",n=null,s="",o=!1,r=""){var l;l=""==s||-1==s.indexOf("http://")&&-1==s.indexOf("https://")?e:i.getFileNativePath(e),l=t.URL.postFormatURL(l),i.fs.readFile({filePath:l,encoding:a,success:function(e){null!=n&&n.runWith([0,e])},fail:function(e){e&&""!=s?i.downFiles(s,a,n,s,o,r):null!=n&&n.runWith([1])}})}static isFile(e){let t;try{t=i.fs.statSync(e)}catch(e){return!1}return t.isFile()}static downFiles(e,a="utf8",n=null,s="",o=!1,r="",l=!0){e=t.URL.postFormatURL(e),i.down({url:e,success:t=>{200===t.statusCode?i.readFile(t.tempFilePath,a,n,s,o,r,l):403===t.statusCode?null!=n&&n.runWith([0,e]):null!=n&&n.runWith([1,t])},fail:e=>{null!=n&&n.runWith([1,e])}}).onProgressUpdate((function(e){null!=n&&n.runWith([2,e.progress])}))}static readFile(e,a="utf8",n=null,s="",o=!1,r="",l=!0){e=t.URL.postFormatURL(e),i.fs.readFile({filePath:e,encoding:a,success:t=>{-1==s.indexOf("http://")&&-1==s.indexOf("https://")||-1!=e.indexOf(d.window.wx.env.USER_DATA_PATH)?null!=n&&n.runWith([0,t]):d.AutoCacheDownFile||o?(null!=n&&n.runWith([0,t]),i.copyTOCache(e,s,null,a,l)):null!=n&&n.runWith([0,t])},fail:e=>{e&&null!=n&&n.runWith([1,e])}})}static downOtherFiles(e,t=null,a="",n=!1,s=!0){i.down({url:e,success:function(e){200===e.statusCode?(d.autoCacheFile||n)&&-1==a.indexOf("qlogo.cn")&&-1==a.indexOf(".php")?(null!=t&&t.runWith([0,e.tempFilePath]),i.copyTOCache(e.tempFilePath,a,null,"",s)):null!=t&&t.runWith([0,e.tempFilePath]):null!=t&&t.runWith([1,e])},fail:function(e){null!=t&&t.runWith([1,e])}})}static copyFile(e,t,a=null){i.fs.copyFile({srcPath:e,destPath:t,success:function(){a&&a.runWith(0)},fail:function(e){a&&a.runWith([1,e])}})}static downLoadFile(e,a="",n=null,s="utf8"){window.navigator.userAgent.indexOf("MiniGame")<0?t.Laya.loader.load(e,n):a==t.Loader.IMAGE||a==t.Loader.SOUND?i.downOtherFiles(e,n,e,!0,!1):i.downFiles(e,s,n,e,!0,a,!1)}static copyTOCache(e,t,a,n="",s=!0){i.fileQueue.push({tempFilePath:e,readyUrl:t,encoding:n,isAutoClear:s}),1==i.fileQueue.length&&i.delayWriteFilesListHandle()}static delayWriteFilesListHandle(){var e=i.fileQueue.shift();if(e){var a=e.tempFilePath,n=e.readyUrl,s=e.encoding,o=e.isAutoClear;i.delayWriteFilesList(a,n,s,o),t.Laya.timer.frameOnce(2,null,i.delayWriteFilesListHandle)}}static delayWriteFilesList(e,a,n="",s=!0){var o=e.split("/"),r=o[o.length-1],l=i.getFileInfo(a),u=i.getFileNativePath(r),c=a;i.fakeObj[c]={md5:r,readyUrl:a,size:0,times:t.Browser.now(),encoding:n,tempFilePath:e};var h=d.sizeLimit,f=4194304,p=i.getCacheUseSize();l?l.readyUrl!=a&&i.fs.getFileInfo({filePath:e,success:function(t){s&&p+f+t.size>=h&&(t.size>d.minClearSize&&(d.minClearSize=t.size),i.onClearCacheRes()),i.deleteFile(e,a,null,n,t.size)},fail:function(e){}}):i.fs.getFileInfo({filePath:e,success:function(t){s&&p+f+t.size>=h&&(t.size>d.minClearSize&&(d.minClearSize=t.size),i.onClearCacheRes()),i.fs.copyFile({srcPath:e,destPath:u,success:function(e){i.onSaveFile(a,r,!0,n,null,t.size)},fail:function(e){}})},fail:function(e){}})}static onClearCacheRes(){var e=d.minClearSize,t=[];for(var a in i.filesListObj)"fileUsedSize"!=a&&t.push(i.filesListObj[a]);i.sortOn(t,"times",i.NUMERIC),i.clearSize=0,i.delayClearCacheList(e,t)}static delayClearCacheList(e,a){if(a.length){var n=a.shift();i.clearSize<e&&(i.clearSize+=n.size,i.deleteFile("",n.readyUrl),t.Laya.timer.frameOnce(1,null,i.delayClearCacheList,[e,a]))}}static sortOn(e,t,a=0){return a==i.NUMERIC?e.sort((function(e,i){return e[t]-i[t]})):a==(i.NUMERIC|i.DESCENDING)?e.sort((function(e,i){return i[t]-e[t]})):e.sort((function(e,i){return e[t]-i[t]}))}static getFileNativePath(e){return i.fileNativeDir+"/"+e}static deleteFile(e,t="",a=null,n="",s=0){var o=i.getFileInfo(t),r=i.getFileNativePath(o.md5);if(""==e&&delete i.filesListObj[t],i.fs.unlink({filePath:r,success:function(o){if(""!=e){var r=i.getFileNativePath(e);i.fs.copyFile({srcPath:e,destPath:r,success:function(o){i.onSaveFile(t,e,!0,n,a,s)},fail:function(e){null!=a&&a.runWith([1,e])}})}else i.onSaveFile(t,e,!1,n,a,s)},fail:function(e){null!=a&&a.runWith([1,e])}}),t&&""!=t&&-1!=t.indexOf(".zip")){var l=d.zipHeadFiles[t];if(l)try{i.fs.rmdirSync(l,!0)}catch(e){console.log("目录:"+l+"delete fail"),console.log(e)}}}static deleteAll(){var e=[];for(var t in i.filesListObj)"fileUsedSize"!=t&&e.push(i.filesListObj[t]);for(var a=1,n=e.length;a<n;a++){var s=e[a];i.deleteFile("",s.readyUrl)}i.filesListObj&&i.filesListObj.fileUsedSize&&(i.filesListObj.fileUsedSize=0),i.writeFilesList("",JSON.stringify({}),!1)}static onSaveFile(e,a,n=!0,s="",o=null,r=0){var l=e;if(null==i.filesListObj.fileUsedSize&&(i.filesListObj.fileUsedSize=0),n){var d=i.getFileNativePath(a);i.filesListObj[l]={md5:a,readyUrl:e,size:r,times:t.Browser.now(),encoding:s,tempFilePath:d},i.filesListObj.fileUsedSize=parseInt(i.filesListObj.fileUsedSize)+r,i.writeFilesList(l,JSON.stringify(i.filesListObj),!0),null!=o&&o.runWith([0])}else if(i.filesListObj[l]){var u=parseInt(i.filesListObj[l].size);i.filesListObj.fileUsedSize=parseInt(i.filesListObj.fileUsedSize)-u,i.fakeObj[l].md5==i.filesListObj[l].md5&&delete i.fakeObj[l],delete i.filesListObj[l],i.writeFilesList(l,JSON.stringify(i.filesListObj),!1),null!=o&&o.runWith([0])}}static writeFilesList(e,t,a){var n=i.fileNativeDir+"/"+i.fileListName;i.fs.writeFile({filePath:n,encoding:"utf8",data:t,success:function(e){},fail:function(e){}}),!d.isZiYu&&d.isPosMsgYu&&d.window.wx.postMessage({url:e,data:i.filesListObj[e],isLoad:"filenative",isAdd:a})}static getCacheUseSize(){return i.filesListObj&&i.filesListObj.fileUsedSize?i.filesListObj.fileUsedSize:0}static getCacheList(e,t){let a;try{a=i.fs.statSync(e)}catch(e){a=null}a?i.readSync(i.fileListName,"utf8",t):(i.fs.mkdirSync(e,!0),t&&t.runWith([1]))}static existDir(e,t){i.fs.access({path:e,success:function(e){i.readSync(i.fileListName,"utf8",t)},fail:function(a){i.fs.mkdir({dirPath:e,success:function(e){null!=t&&t.runWith([0,{data:JSON.stringify({})}])},fail:function(e){-1!=e.errMsg.indexOf("file already exists")||-1!=e.errMsg.indexOf("File exists")?i.readSync(i.fileListName,"utf8",t):null!=t&&t.runWith([1,e])}})}})}static readSync(e,t="utf8",a=null,n=""){var s,o=i.getFileNativePath(e);try{s=i.fs.readFileSync(o,t),null!=a&&a.runWith([0,{data:s}])}catch(e){null!=a&&a.runWith([1])}}static setNativeFileDir(e){i.fileNativeDir=d.window.wx.env.USER_DATA_PATH+e}}i.fs=window.wx.getFileSystemManager(),i.down=window.wx.downloadFile,i.filesListObj={},i.fakeObj={},i.fileListName="layaairfiles.txt",i.ziyuFileData={},i.ziyuFileTextureData={},i.loadPath="",i.DESCENDING=2,i.NUMERIC=16,i.fileQueue=[],i.clearSize=0;class a extends t.SoundChannel{constructor(e){super(),this._sound=e,this._audio=e._sound,this._onCanplay=this.onCanPlay.bind(this),this._onError=this.onError.bind(this),this._onEnd=this.__onEnd.bind(this),this.addEventListener()}addEventListener(){this._audio.onError(this._onError),this._audio.onCanplay(this._onCanplay)}offEventListener(){this._audio.offError(this._onError),this._audio.offCanplay(this._onCanplay),this._audio.offEnded(this._onEnd)}onError(e){console.log("-----1---------------minisound-----url:",this.url),console.log(e),this.event(t.Event.ERROR),this._audio&&(this.offEventListener(),this._sound.dispose(),this._sound=this._audio=null)}onCanPlay(){this._audio&&(this.event(t.Event.COMPLETE),this.offEventListener(),this._audio.onEnded(this._onEnd),this.isStopped?this.stop():this.play())}__onEnd(){if(1==this.loops)return this.completeHandler&&(t.Laya.systemTimer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event(t.Event.COMPLETE);this.loops>0&&this.loops--,this.startTime=0,this.play()}play(){this.isStopped=!1,t.SoundManager.addChannel(this),this._audio&&this._audio.play()}set startTime(e){this._audio&&(this._audio.startTime=e)}set autoplay(e){this._audio&&(this._audio.autoplay=e)}get autoplay(){return!!this._audio&&this._audio.autoplay}get position(){return this._audio?this._audio.currentTime:0}get duration(){return this._audio?this._audio.duration:0}stop(){super.stop(),this.isStopped=!0,t.SoundManager.removeChannel(this),this.completeHandler=null,this._audio&&(this._audio.stop(),this.loop||(this.offEventListener(),this._sound.dispose(),this._sound=null,this._audio=null))}pause(){this.isStopped=!0,this._audio&&this._audio.pause()}get loop(){return!!this._audio&&this._audio.loop}set loop(e){this._audio&&(this._audio.loop=e)}resume(){this.isStopped=!1,t.SoundManager.addChannel(this),this._audio&&this._audio.play()}set volume(e){this._audio&&(this._audio.volume=e)}get volume(){return this._audio?this._audio.volume:0}}class n extends t.EventDispatcher{constructor(){super(),this.loaded=!1,this._sound=n._createSound()}static _createSound(){return n._id++,d.window.wx.createInnerAudioContext()}load(e){if("string"!=typeof e)return e.loader.fetch(e.url,"sound",e.progress.createCallback(),e.options).then((e=>e));var a=e;if(a=t.URL.formatURL(a),i.isLocalNativeFile(a)){if(!i.isLocalNativeZipFile(a)&&i.isNetFile(a))if(""!=i.loadPath)a=a.split(i.loadPath)[1];else{var n=""!=t.URL.rootPath?t.URL.rootPath:t.URL.basePath;""!=(n=47!=n.charCodeAt(n.length-1)?n+"/":n)&&(a=a.split(n)[1])}}else a=t.URL.formatURL(a);if(this.url=a,this.readyUrl=a,d.autoCacheFile&&i.getFileInfo(a))this.onDownLoadCallBack(a,0);else if(d.autoCacheFile)if(i.isLocalNativeFile(a)){if(d.subNativeFiles&&0==d.subNativeheads.length)for(var s in d.subNativeFiles){var o=d.subNativeFiles[s];d.subNativeheads=d.subNativeheads.concat(o);for(let e=0;e<o.length;e++)d.subMaps[o[e]]=s+"/"+o[e]}if(d.subNativeFiles&&-1!=a.indexOf("/")){var r=a.split("/")[0]+"/";if(r&&-1!=d.subNativeheads.indexOf(r)){var l=d.subMaps[r];a=a.replace(r,l)}}this.onDownLoadCallBack(a,0)}else i.isNetFile(a)?i.downOtherFiles(a,t.Handler.create(this,this.onDownLoadCallBack,[a]),a):this.onDownLoadCallBack(a,0);else this.onDownLoadCallBack(a,0)}onDownLoadCallBack(e,a,n=null){var s;if(!a&&this._sound)if(d.autoCacheFile){if(n)s=n;else if(i.isLocalNativeFile(e)){var o=""!=t.URL.rootPath?t.URL.rootPath:t.URL.basePath,r=e;""==(o=47!=o.charCodeAt(o.length-1)?o+"/":o)||-1==e.indexOf("http://")&&-1==e.indexOf("https://")||(s=e.split(o)[1]),s||(s=r),-1==s.indexOf(d.window.wx.env.USER_DATA_PATH)&&i.isLocalNativeZipFile(s)&&(s=i.getFileNativePath(s))}else{var l=i.getFileInfo(e);s=l&&l.md5?l.tempFilePath||i.getFileNativePath(l.md5):e}this._sound.src=this.readyUrl=s}else this._sound.src=this.readyUrl=e;else this.event(t.Event.ERROR)}play(e=0,i=0){if(!this.url)return null;var n=new a(this);return n.url=this.url,n.loops=i,n.loop=0===i,n.startTime=e,n.isStopped=!1,t.SoundManager.addChannel(n),n}get duration(){return this._sound.duration}dispose(){this._sound&&(this._sound.destroy(),this._sound=null,this.readyUrl=this.url=null)}}n._id=0;class s{constructor(){}static _createInputElement(){t.Input._initInput(t.Input.area=t.Browser.createElement("textarea")),t.Input._initInput(t.Input.input=t.Browser.createElement("input")),t.Input.inputContainer=t.Browser.createElement("div"),t.Input.inputContainer.style.position="absolute",t.Input.inputContainer.style.zIndex=1e5,t.Browser.container.appendChild(t.Input.inputContainer),t.Laya.stage.on("resize",null,s._onStageResize),d.window.wx.onWindowResize&&d.window.wx.onWindowResize((function(e){})),t.SoundManager._soundClass=n,t.SoundManager._musicClass=n;let e=d.systemInfo.platform;"ios"===e?(t.Browser.onIOS=!0,t.Browser.onIPhone=!0,t.Browser.onIPad=!0,t.Browser.onAndroid=!1,t.Browser.platform=t.Browser.PLATFORM_IOS):"android"===e?(t.Browser.onIOS=!1,t.Browser.onIPhone=!1,t.Browser.onIPad=!1,t.Browser.onAndroid=!0,t.Browser.platform=t.Browser.PLATFORM_ANDROID):(t.Browser.onIOS=!1,t.Browser.onIPhone=!1,t.Browser.onIPad=!1,t.Browser.onAndroid=!1,t.Browser.platform=t.Browser.PLATFORM_PC)}static _onStageResize(){t.Laya.stage._canvasTransform.identity().scale(t.Browser.width/t.Render.canvas.width/t.Browser.pixelRatio,t.Browser.height/t.Render.canvas.height/t.Browser.pixelRatio)}static wxinputFocus(e){var i=t.Input.inputElement.target;i&&!i.editable||(d.window.wx.offKeyboardConfirm(),d.window.wx.offKeyboardInput(),d.window.wx.showKeyboard({defaultValue:i.text,maxLength:i.maxChars<=0?s._maxChars:i.maxChars,multiple:i.multiline,confirmHold:!0,confirmType:i.confirmType||"done",success:function(e){},fail:function(e){}}),d.window.wx.onKeyboardConfirm((function(e){var a=e?e.value:"";i._restrictPattern&&(a=a.replace(/\u2006|\x27/g,""),i._restrictPattern.test(a)&&(a=a.replace(i._restrictPattern,""))),i.text=a,i.event(t.Event.INPUT),s.inputEnter(),i.event("confirm"),i.event("enter")})),d.window.wx.onKeyboardInput((function(e){var a=e?e.value:"";i.multiline||-1==a.indexOf("\n")?(i._restrictPattern&&(a=a.replace(/\u2006|\x27/g,""),i._restrictPattern.test(a)&&(a=a.replace(i._restrictPattern,""))),i.text=a,i.miniGameTxt&&i.miniGameTxt(a),i.event(t.Event.INPUT)):s.inputEnter()})))}static inputEnter(){t.Input.inputElement.target.focus=!1}static wxinputblur(){s.hideKeyboard()}static hideKeyboard(){d.window.wx.offKeyboardConfirm(),d.window.wx.offKeyboardInput(),d.window.wx.hideKeyboard({success:function(e){console.log("隐藏键盘")},fail:function(e){console.log("隐藏键盘出错:"+(e?e.errMsg:""))}})}}s._maxChars=1e5;class o extends t.EventDispatcher{constructor(){super()}download(e){o._loadResourceFilter(e,this)}static _loadResourceFilter(e,a){var n=e.contentType,s=e.url;if(this.sourceUrl=t.URL.formatURL(s),i.isNetFile(s))if(""!=i.loadPath)s=s.split(i.loadPath)[1];else{var r=""!=t.URL.rootPath?t.URL.rootPath:t.URL.basePath,l=s;""!=(r=47!=r.charCodeAt(r.length-1)?r+"/":r)&&(s=s.split(r)[1]),s||(s=l)}if(d.subNativeFiles&&0==d.subNativeheads.length)for(var u in d.subNativeFiles){var c=d.subNativeFiles[u];d.subNativeheads=d.subNativeheads.concat(c);for(var h=0;h<c.length;h++)d.subMaps[c[h]]=u+"/"+c[h]}if(d.subNativeFiles&&-1!=s.indexOf("/")){var f=s.split("/")[0]+"/";if(f&&-1!=d.subNativeheads.indexOf(f)){var p=d.subMaps[f];s=s.replace(f,p)}}switch(e.url=s,n){case t.Loader.IMAGE:case"htmlimage":case"nativeimage":o.onLoadImage(e,a);break;case t.Loader.SOUND:o.onLoadSound(e,a);break;default:o.onLoadOtherFile(e,n,a)}}static onLoadSound(e,a){var n=e.url,s=t.URL.formatURL(e.url);d.autoCacheFile?i.isLocalNativeFile(n)||i.getFileInfo(s)?o.onLoadSoundCB(e,a,0):i.isNetFile(s)?(e.url=s,i.downOtherFiles(s,t.Handler.create(o,o.onLoadSoundCB,[e,a]),s)):o.onLoadSoundCB(e,a,0):o.onLoadSoundCB(e,a,0)}static onLoadSoundCB(e,a,n,s=null){var o=e.url,r=t.URL.formatURL(e.url);if(n)a.completeItem(e,null);else{var l;if(d.autoCacheFile)if(s)l=s;else if(i.isLocalNativeFile(o))-1==(l=o).indexOf(d.window.wx.env.USER_DATA_PATH)&&i.isLocalNativeZipFile(l)&&(l=i.getFileNativePath(l));else{var u=i.getFileInfo(r);l=u&&u.md5?u.tempFilePath||i.getFileNativePath(u.md5):r}else l=r;o=l;var c=new t.SoundManager._soundClass;c.load(o),a.completeItem(e,c)}}static onLoadOtherFile(e,a,n){var s=e.url,r=t.URL.formatURL(e.url),l=d.getUrlEncode(r,a);e.url=r;let u=t.Loader.preLoadedMap[r];if(u)n.completeItem(e,u);else if(d.AutoCacheDownFile)if(i.isLocalNativeFile(s)||i.getFileInfo(r)){var c=s,h=i.getFileInfo(r);h&&h.md5&&(c=h.tempFilePath||i.getFileNativePath(h.md5)),i.readFile(c,l,new t.Handler(o,o.onLoadOtherFileCB,[e,a,n]),r)}else i.isNetFile(r)?i.downFiles(r,l,new t.Handler(o,o.onLoadOtherFileCB,[e,a,n]),r,!0):i.readFile(s,l,new t.Handler(o,o.onLoadOtherFileCB,[e,a,n]),r);else i.isNetFile(r)?n._download(e):(-1==s.indexOf(d.window.wx.env.USER_DATA_PATH)&&i.isLocalNativeZipFile(s)&&(s=i.getFileNativePath(s)),i.readFile(s,l,new t.Handler(o,o.onLoadOtherFileCB,[e,a,n]),r))}static onLoadOtherFileCB(e,i=null,a=null,n=0,s=null){var o,r=e.url;n?1==n&&a.completeItem(e,null):(o=i==t.Loader.JSON||i==t.Loader.ATLAS||i==t.Loader.HIERARCHY||i==t.Loader.MATERIAL?d.getJson(s.data):i==t.Loader.XML?new t.XML(s.data):s.data,!d.isZiYu&&d.isPosMsgYu&&i!=t.Loader.BUFFER&&d.window.wx.postMessage({url:r,data:o,isLoad:"filedata"}),a.completeItem(e,o))}static onLoadImage(e,a){var n=e.url,s=t.URL.formatURL(e.url);if(d.isZiYu||i.isLocalNativeFile(n))return i.isLocalNativeZipFile(n)&&(e.url=i.getFileNativePath(n)),void a._download(e);d.autoCacheFile?i.isLocalNativeFile(n)||i.getFileInfo(s)?o.onCreateImage(e,a,!1):i.isNetFile(s)?(e.url=s,i.downOtherFiles(s,new t.Handler(o,o.onDownImgCallBack,[e,a]),s)):o.onCreateImage(e,a,!0):(e.url=s,a._download(e))}static onDownImgCallBack(e,t,i,a=""){i?t.completeItem(e,null):o.onCreateImage(e,t,!1,a)}static onCreateImage(e,a,n=!1,s=""){var o,r=e.url;if(d.autoCacheFile)if(n)if(d.isZiYu){var l=t.URL.formatURL(r);o=i.ziyuFileTextureData[l]?i.ziyuFileTextureData[l]:r}else o=r;else if(""!=s)o=s;else{var u=i.getFileInfo(t.URL.formatURL(r));o=u.tempFilePath||i.getFileNativePath(u.md5)}else o=n?r:s;e.url=o,a._download(e)}}class r{constructor(){}static __init__(){r.items=r}static setItem(e,t){try{d.window.wx.setStorageSync(e,t)}catch(i){d.window.wx.setStorage({key:e,data:t})}}static getItem(e){return d.window.wx.getStorageSync(e)}static setJSON(e,t){r.setItem(e,t)}static getJSON(e){return r.getItem(e)}static removeItem(e){d.window.wx.removeStorageSync(e)}static clear(){d.window.wx.clearStorageSync()}static getStorageInfoSync(){try{var e=d.window.wx.getStorageInfoSync();return console.log(e.keys),console.log(e.currentSize),console.log(e.limitSize),e}catch(e){}return null}}r.support=!0;class l{load(e){if(e){var i=t.URL.formatURL(e.url),a=d.window.wx.loadFont(i);return new Promise((e=>{a?e({family:a}):e(null)}))}}}class d{static getJson(e){return JSON.parse(e)}static enable(){d.init(t.Laya.isWXPosMsg,t.Laya.isWXOpenDataContext)}static init(e=!1,a=!1){d._inited||(d._inited=!0,d.window=window,d.window.hasOwnProperty("wx")&&(!d.window.conch&&d.window.navigator.userAgent.indexOf("MiniGame")<0||(d.isZiYu=a,d.isPosMsgYu=e,d.EnvConfig={},d.isZiYu||(i.setNativeFileDir("/layaairGame"),i.getCacheList(i.fileNativeDir,t.Handler.create(d,d.onMkdirCallBack))),d.systemInfo=d.window.wx.getSystemInfoSync(),d.window.focus=function(){},t.URL.__init__=function(){t.URL.basePath=t.URL.rootPath=""},d.window.logtime=function(e){},d.window.alertTimeLog=function(e){},d.window.resetShareInfo=function(){},d.window.CanvasRenderingContext2D=function(){},d.window.conch?(i.fs.readFile({filePath:"app/appConfig.json",encoding:"utf8",success:function(e){var t=JSON.parse(e.data).preDownloadFiles;for(var i in t)d.preDownloadFiles[t[i]]=!0},fail:function(e){}}),d._preCreateElement=t.Browser.createElement,t.Browser.createElement=function(e){return"textarea"==e||"input"==e?d.onCreateInput(e):d._preCreateElement(e)},t.Input._createInputElement=s._createInputElement):(d.window.CanvasRenderingContext2D.prototype=d.window.wx.createCanvas().getContext("2d").__proto__,d.window.document.body.appendChild=function(){},d.EnvConfig.pixelRatioInt=0,t.Browser._pixelRatio=d.pixelRatio(),d._preCreateElement=t.Browser.createElement,t.Browser.createElement=d.createElement,t.RunDriver.createShaderCondition=d.createShaderCondition,t.Input._createInputElement=s._createInputElement,window.ImageData||(window.ImageData=ImageDataPolyfill)),t.Loader.prototype._download=t.Loader.prototype.download,t.Loader.prototype.download=o.prototype.download,t.Loader.registerLoader(["ttf","woff","woff2","otf"],l,t.Loader.TTF),t.Loader.registerLoader(["mp3","wav","ogg"],n,t.Loader.SOUND),d.window.conch||(t.LocalStorage._baseClass=r,r.__init__(),d.window.wx.onMessage&&d.window.wx.onMessage(d._onMessage)),window.WebAssembly={},t.WasmAdapter.Memory=d.window.WXWebAssembly.Memory,t.WasmAdapter.instantiateWasm=d.WasmAdapter)))}static WasmAdapter(e,t){if(!d.window.WXWebAssembly)throw new Error(" ==== 不支持wasm加载 ====");return d.window.WXWebAssembly.instantiate("libs/"+e,t)}static _onMessage(e){switch(e.type){case"changeMatrix":t.Laya.stage.transform.identity(),t.Laya.stage._width=e.w,t.Laya.stage._height=e.h,t.Laya.stage._canvasTransform=new t.Matrix(e.a,e.b,e.c,e.d,e.tx,e.ty);break;case"display":t.Laya.stage.frameRate=e.rate||t.Stage.FRAME_FAST;break;case"undisplay":t.Laya.stage.frameRate=t.Stage.FRAME_SLEEP}"opendatacontext"==e.isLoad?e.url&&(i.ziyuFileData[e.url]=e.atlasdata,i.ziyuFileTextureData[e.imgReadyUrl]=e.imgNativeUrl):"openJsondatacontext"==e.isLoad?e.url&&(i.ziyuFileData[e.url]=e.atlasdata):"openJsondatacontextPic"==e.isLoad&&(i.ziyuFileTextureData[e.imgReadyUrl]=e.imgNativeUrl)}static loadZip(e,t,a,n,s=0){var o=i.fs;if(o&&o.unzip){d.nativefiles.push(t),d.nativezipfiles.push(t);var r=i.fileNativeDir+"/"+t;d.zipHeadFiles[e]=t,o.access({path:r,success:function(t){if(1==s){try{o.rmdirSync(r,!0)}catch(e){console.log("目录删除成功"),console.log(e)}o.mkdir({dirPath:r,recursive:!0,success:function(t){d.downZip(e,r,o,a,n)}.bind(this),fail:function(e){null!=a&&a.runWith([{errCode:3,errMsg:"创建压缩包目录失败",wxData:e}])}.bind(this)})}else if(2==s)d.downZip(e,r,o,a,n);else{i.getFileInfo(e)?null!=a&&a.runWith([{errCode:0,errMsg:"zip包目录存在，直接返回完成",wxData:t}]):d.downZip(e,r,o,a,n)}}.bind(this),fail:function(t){t&&-1!=t.errMsg.indexOf("access:fail no such file or directory")&&o.mkdir({dirPath:r,recursive:!0,success:function(t){d.downZip(e,r,o,a,n)}.bind(this),fail:function(e){null!=a&&a.runWith([{errCode:3,errMsg:"创建压缩包目录失败",wxData:e}])}.bind(this)})}.bind(this)})}else null!=a&&a.runWith([{errCode:2,errMsg:"微信压缩接口不支持"}])}static downZip(e,t,a,n,s){var o={zipFilePath:e,targetPath:t,success:function(e){null!=n&&n.runWith([{errCode:0,errMsg:"解压成功",wxData:e}])}.bind(this),fail:function(e){null!=n&&n.runWith([{errCode:1,errMsg:"解压失败",wxData:e}])}.bind(this)};-1==e.indexOf("http://")&&-1==e.indexOf("https://")?a.unzip(o):window.wx.downloadFile({url:e,success:function(t){200===t.statusCode?(o.zipFilePath=t.tempFilePath,a.unzip(o),i.copyTOCache(t.tempFilePath,e,null,"utf8",!0)):null!=n&&n.runWith([{errCode:4,errMsg:"远端下载zip包失败",wxData:t}])}.bind(this),fail:function(e){null!=n&&n.runWith([{errCode:4,errMsg:"远端下载zip包失败",wxData:e}])}.bind(this)}).onProgressUpdate((function(e){null!=s&&s.runWith([{errCode:5,errMsg:"zip包下载中",progress:e.progress}])}))}static getUrlEncode(e,t){return"arraybuffer"==t?"":"utf8"}static downLoadFile(e,t="",a=null,n="utf8"){i.getFileInfo(e)?null!=a&&a.runWith([0]):i.downLoadFile(e,t,a,n)}static remove(e,t=null){i.deleteFile("",e,t,"",0)}static removeAll(){i.deleteAll()}static hasNativeFile(e){return i.isLocalNativeFile(e)}static getFileInfo(e){return i.getFileInfo(e)}static getFileList(){return i.filesListObj}static exitMiniProgram(){d.window.wx.exitMiniProgram()}static onMkdirCallBack(e,t){e?(i.fakeObj={},i.filesListObj={}):(i.filesListObj=JSON.parse(t.data),i.fakeObj=JSON.parse(t.data));let a=i.fs.readdirSync(i.fileNativeDir);if(a.length){var n,s,o={};for(let e in i.filesListObj)"fileUsedSize"!=e&&(o[(n=i.filesListObj[e]).md5]=n.readyUrl);for(let e=0,t=a.length;e<t;e++)if((s=a[e])!=i.fileListName){if(!o[s]){let e=i.getFileNativePath(s);i.fs.unlink({filePath:e,success:function(e){console.log("删除无引用的磁盘文件:"+s)}})}delete o[s]}for(let e in o)delete i.filesListObj[o[e]],delete i.fakeObj[o[e]],console.log("删除错误记录：",o[e])}}static pixelRatio(){if(!d.EnvConfig.pixelRatioInt)try{return d.EnvConfig.pixelRatioInt=d.systemInfo.pixelRatio,d.systemInfo.pixelRatio}catch(e){}return d.EnvConfig.pixelRatioInt}static createElement(e){var t;if("canvas"==e)return 1==d.idx?d.isZiYu?(t=d.window.sharedCanvas).style={}:t=d.window.canvas:t=d.window.wx.createCanvas(),d.idx++,t;if("textarea"==e||"input"==e)return d.onCreateInput(e);if("div"==e){var i=d._preCreateElement(e);return i.contains=function(e){return null},i.removeChild=function(e){},i}return d._preCreateElement(e)}static onCreateInput(e){var t=d._preCreateElement(e);return t.focus=s.wxinputFocus,t.blur=s.wxinputblur,t.style={},t.value=0,t.parentElement={},t.placeholder={},t.type={},t.setColor=function(e){},t.setType=function(e){},t.setFontFace=function(e){},t.addEventListener=function(e){},t.contains=function(e){return null},t.removeChild=function(e){},t}static createShaderCondition(e){return function(){return this[e.replace("this.","")]}}static sendAtlasToOpenDataContext(e){if(!d.isZiYu){var i=t.Loader.getRes(e);if(!i)throw"传递的url没有获取到对应的图集数据信息，请确保图集已经过！";if(i.meta&&i.meta.image)for(var a=i.meta.image.split(","),n=e.indexOf("/")>=0?"/":"\\",s=e.lastIndexOf(n),o=s>=0?e.substr(0,s+1):"",r=0,l=a.length;r<l;r++)a[r]=o+a[r];else a=[e.replace(".json",".png")];for(r=0;r<a.length;r++){var u=a[r];d.postInfoToContext(t.Laya.URL.formatURL(e),t.Laya.URL.formatURL(u),i)}}}static postInfoToContext(e,a,n){var s={frames:n.frames,meta:n.meta},o=a,r=i.getFileInfo(t.URL.formatURL(a));if(r)var l=r.tempFilePath||i.getFileNativePath(r.md5);else l=o;if(!l)throw"获取图集的磁盘url路径不存在！";d.window.wx.postMessage({url:e,atlasdata:s,imgNativeUrl:l,imgReadyUrl:o,isLoad:"opendatacontext"})}static sendSinglePicToOpenDataContext(e){var a=t.Laya.URL.formatURL(e),n=i.getFileInfo(a);if(n){var s=n.tempFilePath||i.getFileNativePath(n.md5);e=a}else s=e;if(!s)throw"获取图集的磁盘url路径不存在！";d.window.wx.postMessage({url:a,imgNativeUrl:s,imgReadyUrl:a,isLoad:"openJsondatacontextPic"})}static sendJsonDataToDataContext(e){if(!d.isZiYu){e=t.Laya.URL.formatURL(e);var i=t.Loader.getRes(e);if(!i)throw"传递的url没有获取到对应的图集数据信息，请确保图集已经过！";d.window.wx.postMessage({url:e,atlasdata:i,isLoad:"openJsondatacontext"})}}}d._inited=!1,d.autoCacheFile=!0,d.minClearSize=5242880,d.sizeLimit=209715200,d.nativefiles=["layaNativeDir","wxlocal"],d.nativezipfiles=[],d.zipRequestHead="",d.zipHeadFiles={},d.subNativeFiles=[],d.subNativeheads=[],d.subMaps=[],d.AutoCacheDownFile=!1,d.preDownloadFiles={},d.parseXMLFromString=function(e){var t;e=e.replace(/>\s+</g,"><");try{t=(new d.window.Parser.DOMParser).parseFromString(e,"text/xml")}catch(e){throw"需要引入xml解析库文件"}return t},d.idx=1;class u extends t.EventDispatcher{constructor(){super()}static __init__(){try{var e;if(!(e=t.Accelerator))return;e.prototype.on=u.prototype.on,e.prototype.off=u.prototype.off}catch(e){}}static startListen(e){if(u._callBack=e,!u._isListening){u._isListening=!0;try{d.window.wx.onAccelerometerChange(u.onAccelerometerChange)}catch(e){}}}static stopListen(){u._isListening=!1;try{d.window.wx.stopAccelerometer({})}catch(e){}}static onAccelerometerChange(e){var t;(t={}).acceleration=e,t.accelerationIncludingGravity=e,t.rotationRate={},null!=u._callBack&&u._callBack(t)}on(e,t,i,a=null){return super.on(e,t,i,a),u.startListen(this.onDeviceOrientationChange),this}off(e,t,i,a=!1){return this.hasListener(e)||u.stopListen(),super.off(e,t,i,a)}}u._isListening=!1;class c{constructor(){}static __init__(){d.window.navigator.geolocation.getCurrentPosition=c.getCurrentPosition,d.window.navigator.geolocation.watchPosition=c.watchPosition,d.window.navigator.geolocation.clearWatch=c.clearWatch}static getCurrentPosition(e=null,t=null,i=null){var a;(a={}).success=function(t){null!=e&&e(t)},a.fail=t,d.window.wx.getLocation(a)}static watchPosition(e=null,i=null,a=null){var n;return c._curID++,(n={}).success=e,n.error=i,c._watchDic[c._curID]=n,t.Laya.systemTimer.loop(1e3,null,c._myLoop),c._curID}static clearWatch(e){delete c._watchDic[e],c._hasWatch()||t.Laya.systemTimer.clear(null,c._myLoop)}static _hasWatch(){var e;for(e in c._watchDic)if(c._watchDic[e])return!0;return!1}static _myLoop(){c.getCurrentPosition(c._mySuccess,c._myError)}static _mySuccess(e){var i,a={};for(i in a.coords=e,a.timestamp=t.Browser.now(),c._watchDic)c._watchDic[i].success&&c._watchDic[i].success(a)}static _myError(e){var t;for(t in c._watchDic)c._watchDic[t].error&&c._watchDic[t].error(e)}}c._watchDic={},c._curID=0;e.ImageDataPolyfill=ImageDataPolyfill,e.MiniAccelerator=u,e.MiniAdpter=d,e.MiniFileMgr=i,e.MiniInput=s,e.MiniLoader=o,e.MiniLocalStorage=r,e.MiniLocation=c,e.MiniSound=n,e.MiniSoundChannel=a,e.MiniTTFFontLoader=l,e.MiniVideo=class{constructor(e=320,t=240){this.videoend=!1,this.videourl="",this.videoElement=d.window.wx.createVideo({width:e,height:t,autoplay:!0})}static __init__(){}on(e,t,i){"loadedmetadata"==e?(this.onPlayFunc=i.bind(t),this.videoElement.onPlay(this.onPlayFunction.bind(this))):"ended"==e&&(this.onEndedFunC=i.bind(t),this.videoElement.onEnded(this.onEndedFunction.bind(this))),this.videoElement.onTimeUpdate(this.onTimeUpdateFunc.bind(this))}onTimeUpdateFunc(e){this.position=e.position,this._duration=e.duration}get duration(){return this._duration}onPlayFunction(){this.videoElement&&(this.videoElement.readyState=200),console.log("=====视频加载完成========"),null!=this.onPlayFunc&&this.onPlayFunc()}onEndedFunction(){this.videoElement&&(this.videoend=!0,console.log("=====视频播放完毕========"),null!=this.onEndedFunC&&this.onEndedFunC())}off(e,t,i){"loadedmetadata"==e?(this.onPlayFunc=i.bind(t),this.videoElement.offPlay(this.onPlayFunction.bind(this))):"ended"==e&&(this.onEndedFunC=i.bind(t),this.videoElement.offEnded(this.onEndedFunction.bind(this)))}load(e){this.videoElement&&(this.videoElement.src=e)}play(){this.videoElement&&(this.videoend=!1,this.videoElement.play())}pause(){this.videoElement&&(this.videoend=!0,this.videoElement.pause())}get currentTime(){return this.videoElement?this.videoElement.initialTime:0}set currentTime(e){this.videoElement&&(this.videoElement.initialTime=e)}get videoWidth(){return this.videoElement?this.videoElement.width:0}get videoHeight(){return this.videoElement?this.videoElement.height:0}get ended(){return this.videoend}get loop(){return!!this.videoElement&&this.videoElement.loop}set loop(e){this.videoElement&&(this.videoElement.loop=e)}get playbackRate(){return this.videoElement?this.videoElement.playbackRate:0}set playbackRate(e){this.videoElement&&(this.videoElement.playbackRate=e)}get muted(){return!!this.videoElement&&this.videoElement.muted}set muted(e){this.videoElement&&(this.videoElement.muted=e)}get paused(){return!!this.videoElement&&this.videoElement.paused}size(e,t){this.videoElement&&(this.videoElement.width=e,this.videoElement.height=t)}get x(){return this.videoElement?this.videoElement.x:0}set x(e){this.videoElement&&(this.videoElement.x=e)}get y(){return this.videoElement?this.videoElement.y:0}set y(e){this.videoElement&&(this.videoElement.y=e)}get currentSrc(){return this.videoElement.src}destroy(){this.videoElement&&this.videoElement.destroy(),this.videoElement=null,this.onEndedFunC=null,this.onPlayFunc=null,this.videoend=!1,this.videourl=null}reload(){this.videoElement&&(this.videoElement.src=this.videourl)}}};